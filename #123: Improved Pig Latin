"""
Pig Latin is a language constructed by transforming English words. While the origins of the language are unknown, 
it is mentioned in at least two documents from the nineteenth century, suggesting that it has existed for more than 
100 years. The following rules are used to translate English into Pig Latin:

1. If the word begins with a consonant (including y) then all letters at the beginning of the word, up to the first
    vowel (excluding y), are removed and then added to the end of the word, followed by ay. For example computer
    becomes omputercay and think becomes inkthay.
2. If the word begins with a vowel (not including y), then way is added to the end of the word. For example, 
    algorithm becaomes algorithmway and office becomes officeway.
    
It needs to correctly handle uppercase letters and punctuation marks such as commas, periods, question marks and exclamation marks. 
If an English word begins with an uppercase letter then its Pig Latin representation should also begin with an uppercase letter and the uppercase letter 
moved to the end of the word should be changed to lowercase. For example, Computer should become Omputercay. If a word ends in a punctuation 
mark then the punctuation mark should remain at the end of the word after the transformation has been performed. 
For example, Science! should become Iencescay!."""

def pig_latin_improved(string):
    new_string = ""
    for word in string.split(" "):
        term = ""
        start = ""
        middle = ""
        end = ""
        punctuation = ""
        if word[0] in "aeiou":
            for letter in word:
                if letter.isalpha():
                    term += letter
                else:
                    punctuation += letter           
            new_string += term + "way" + punctuation + " "
        
        elif word[0].lower() in "bcdfghjklmnpqrstvwxyz":    
            for letter in word:
                if letter.lower() in "bcdfghjklmnpqrstvwxyz" and end == "":
                    start += letter.lower()
                elif letter in "bcdfghjklmnpqrstvwxyz" and end != "":
                    middle += letter.lower()
                elif letter in ",.?-!:;'":
                    punctuation += letter
                elif letter in "aeiou" and middle == "":
                    end += letter.lower()
                elif letter in "aeiou" and middle != "":
                    middle += letter.lower()
            
            if word[0].isupper() == True:
                term = end[0].upper() + end[1:].lower() + middle + start + "ay" + punctuation
            else:
                term = end.lower() + middle + start + "ay" + punctuation
            new_string += term + " "
        else:
            new_string += word + " "
    return new_string       
